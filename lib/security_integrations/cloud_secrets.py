"""\nCloud-agnostic secrets management\nSupports AWS Secrets Manager, Azure Key Vault, and GCP Secret Manager\n"""\n\nimport json\nimport logging\nimport os\nfrom typing import Dict, Optional\n\nlogger = logging.getLogger(__name__)\n\n\nclass CloudSecretsManager:\n    """\n    Unified interface for secrets management across cloud providers\n    Automatically detects cloud environment and uses appropriate service\n    """\n\n    def __init__(self, cloud_provider: Optional[str] = None):\n        """\n        Initialize secrets manager\n\n        Args:\n            cloud_provider: 'aws', 'azure', or 'gcp'. Auto-detected if not specified.\n        """\n        self.cloud_provider = cloud_provider or self._detect_cloud_provider()\n        self._init_client()\n\n    def _detect_cloud_provider(self) -> str:\n        """Auto-detect cloud provider from environment"""\n        if os.getenv('AWS_REGION') or os.getenv('AWS_DEFAULT_REGION'):\n            return 'aws'\n        elif os.getenv('AZURE_SUBSCRIPTION_ID') or os.getenv('AZURE_TENANT_ID'):\n            return 'azure'\n        elif os.getenv('GOOGLE_CLOUD_PROJECT') or os.getenv('GCP_PROJECT'):\n            return 'gcp'\n        else:\n            logger.warning("Could not auto-detect cloud provider, defaulting to AWS")\n            return 'aws'\n\n    def _init_client(self):\n        """Initialize cloud-specific secrets client"""\n        if self.cloud_provider == 'aws':\n            import boto3\n            self.client = boto3.client('secretsmanager')\n            self.get_secret = self._get_secret_aws\n        elif self.cloud_provider == 'azure':\n            from azure.identity import DefaultAzureCredential\n            from azure.keyvault.secrets import SecretClient\n            key_vault_url = os.getenv('AZURE_KEY_VAULT_URL')\n            if not key_vault_url:\n                raise ValueError("AZURE_KEY_VAULT_URL environment variable required for Azure")\n            credential = DefaultAzureCredential()\n            self.client = SecretClient(vault_url=key_vault_url, credential=credential)\n            self.get_secret = self._get_secret_azure\n        elif self.cloud_provider == 'gcp':\n            from google.cloud import secretmanager\n            self.client = secretmanager.SecretManagerServiceClient()\n            self.project_id = os.getenv('GOOGLE_CLOUD_PROJECT') or os.getenv('GCP_PROJECT')\n            if not self.project_id:\n                raise ValueError("GOOGLE_CLOUD_PROJECT environment variable required for GCP")\n            self.get_secret = self._get_secret_gcp\n        else:\n            raise ValueError(f"Unsupported cloud provider: {self.cloud_provider}")\n\n        logger.info(f"Initialized secrets manager for {self.cloud_provider}")\n\n    def _get_secret_aws(self, secret_name: str) -> Dict:\n        """Get secret from AWS Secrets Manager"""\n        try:\n            response = self.client.get_secret_value(SecretId=secret_name)\n            return json.loads(response['SecretString'])\n        except Exception as e:\n            logger.error(f"Error retrieving AWS secret {secret_name}: {e}")\n            raise\n\n    def _get_secret_azure(self, secret_name: str) -> Dict:\n        """Get secret from Azure Key Vault"""\n        try:\n            secret = self.client.get_secret(secret_name)\n            return json.loads(secret.value)\n        except Exception as e:\n            logger.error(f"Error retrieving Azure secret {secret_name}: {e}")\n            raise\n\n    def _get_secret_gcp(self, secret_name: str) -> Dict:\n        """Get secret from GCP Secret Manager"""\n        try:\n            name = f"projects/{self.project_id}/secrets/{secret_name}/versions/latest"\n            response = self.client.access_secret_version(request={"name": name})\n            payload = response.payload.data.decode('UTF-8')\n            return json.loads(payload)\n        except Exception as e:\n            logger.error(f"Error retrieving GCP secret {secret_name}: {e}")\n            raise\n\n    def get_crowdstrike_credentials(self) -> Dict:\n        """Get CrowdStrike API credentials"""\n        secret_names = {\n            'aws': 'crowdstrike/api-credentials',\n            'azure': 'crowdstrike-api-credentials',\n            'gcp': 'crowdstrike-api-credentials-prod'\n        }\n        return self.get_secret(secret_names[self.cloud_provider])\n\n    def get_microsoft_credentials(self) -> Dict:\n        """Get Microsoft API credentials"""\n        secret_names = {\n            'aws': 'microsoft/api-credentials',\n            'azure': 'microsoft-api-credentials',\n            'gcp': 'microsoft-api-credentials-prod'\n        }\n        return self.get_secret(secret_names[self.cloud_provider])\n\n    def get_proofpoint_credentials(self) -> Dict:\n        """Get Proofpoint API credentials"""\n        secret_names = {\n            'aws': 'proofpoint/api-credentials',\n            'azure': 'proofpoint-api-credentials',\n            'gcp': 'proofpoint-api-credentials-prod'\n        }\n        return self.get_secret(secret_names[self.cloud_provider])\n\n    def get_perplexity_credentials(self) -> Dict:\n        """Get Perplexity API credentials"""\n        secret_names = {\n            'aws': 'perplexity/api-credentials',\n            'azure': 'perplexity-api-credentials',\n            'gcp': 'perplexity-api-credentials-prod'\n        }\n        return self.get_secret(secret_names[self.cloud_provider])\n